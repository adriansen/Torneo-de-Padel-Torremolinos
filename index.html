<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Torneo PÃ¡del Torremolinos</title>
<link rel="stylesheet" href="css/styles.css">
</head>
<body>

<header>
  <nav>
    <ul>
      <li><a href="#reglas">Reglas del Torneo</a></li>
      <li><a href="#partidos">Partidos</a></li>
      <li><a href="#clasificacion">Tabla de ClasificaciÃ³n</a></li>
    </ul>
  </nav>
</header>

<div id="logos-banner">
    <img src="img/logos/12.jpg" alt="Logo 1">
    <img src="img/logos/ache.jpg" alt="Logo 2">
    <img src="img/logos/CPTorr.png" alt="Logo 3">
    <img src="img/logos/AYTO.png" alt="Logo 4">
    <img src="img/logos/NOVA.jpeg" alt="Logo 5">
</div>

<!-- Barra de acceso capitanes -->
<div id="admin-bar" style="margin-top:80px; text-align:center;">
  <button id="btn-capitan">Acceso capitanes</button>
  <button id="btn-borrar-todo" style="display:none; background:#d9534f;">Borrar TODOS los resultados</button>
</div>

<section id="reglas">
  <h1>ğŸ† Reglas del Torneo</h1>
  <div id="reglas-content">

    <h2>ğŸ† REGLAMENTO OFICIAL DEL TORNEO DE PÃDEL</h2>

    <p><strong>Organiza:</strong> Club PÃ¡del Torremolinos<br>
    <strong>Sede:</strong> Patronato de Deportes de Torremolinos<br>
    <strong>Fechas:</strong> 20 y 21 de febrero</p>

    <h3>ğŸ‘¥ FORMATO DE EQUIPOS</h3>
    <p>
      Cada equipo contarÃ¡ con un capitÃ¡n responsable de realizar las alineaciones en cada enfrentamiento.<br>
      Cada equipo estarÃ¡ formado por <strong>5 parejas</strong>.
    </p>

    <h3>ğŸŸï¸ SISTEMA DE LIGAS (POR NIVELES)</h3>
    <p>El torneo se divide en dos ligas por nivel:</p>
    <ul>
      <li><strong>Liga A:</strong> nivel alto</li>
      <li><strong>Liga B:</strong> nivel medio</li>
    </ul>
    <p>Cada liga estarÃ¡ compuesta por 5 equipos. Cada equipo disputarÃ¡ <strong>4 enfrentamientos</strong> durante el torneo.</p>

    <h3>ğŸ“‹ EQUIPOS PARTICIPANTES</h3>

    <p>ğŸ” <strong>Liga A:</strong></p>
    <ul>
      <li>C.P. Torremolinos - A</li>
      <li>Sitges / Cierzo Zaragoza</li>
      <li>Dracs Valencia - A</li>
      <li>GMadrid - A</li>
      <li>Chicota Sevilla - A</li>
    </ul>

    <p>ğŸ”° <strong>Liga B:</strong></p>
    <ul>
      <li>C.P. Torremolinos - B</li>
      <li>Diversport Torremolinos</li>
      <li>Dracs Valencia - B</li>
      <li>GMadrid - B</li>
      <li>Chicota Sevilla - B</li>
    </ul>

    <h3>ğŸ—“ï¸ HORARIOS DE JUEGO</h3>
    <p><strong>Viernes:</strong> 17:00 - 21:00 â†’ 4 enfrentamientos, 5 pistas.</p>
    <p><strong>SÃ¡bado:</strong></p>
    <ul>
      <li>10:00 - 12:00 â†’ 3 enfrentamientos (5 pistas)</li>
      <li>13:00 - 21:00 â†’ resto de enfrentamientos (10 pistas)</li>
    </ul>

    <h3>ğŸ”¢ ALINEACIONES Y ENFRENTAMIENTOS</h3>
    <p>
      Cada enfrentamiento se compone de <strong>5 partidos</strong> (Pareja 1 a Pareja 5).<br>
      La Pareja 1 serÃ¡ la de mayor nivel y se enfrentarÃ¡ a la Pareja 1 rival, y asÃ­ sucesivamente.
    </p>

    <h3>â±ï¸ FORMATO DE LOS PARTIDOS</h3>
    <p>
      DuraciÃ³n mÃ¡xima: <strong>1 hora</strong>.<br>
      Partidos al mejor de <strong>3 sets</strong>, con <strong>punto de oro</strong>.
    </p>

    <h3>âš–ï¸ DESEMPATE EN PARTIDOS</h3>
    <ul>
      <li>Si al finalizar la hora no hay ganador: gana el equipo con mÃ¡s juegos ganados.</li>
      <li>Si persiste el empate: gana el equipo que vaya por delante en ese momento, o se jugarÃ¡ un <strong>punto de oro</strong>.</li>
    </ul>

    <h3>ğŸ“Š SISTEMA DE PUNTUACIÃ“N DE LOS ENFRENTAMIENTOS</h3>
    <p>Cada partido ganado (de pareja) suma <strong>1 punto interno</strong>.</p>
    <p>El resultado global del enfrentamiento determina los puntos de liga:</p>

    <ul>
      <li><strong>1â€“0</strong> â†’ 1 punto para el ganador, 0 para el perdedor</li>
      <li><strong>2â€“0</strong> â†’ 2 puntos para el ganador, 0 para el perdedor</li>
      <li><strong>3â€“2</strong> â†’ 3 puntos para el ganador, 2 para el perdedor</li>
      <li><strong>4â€“1</strong> â†’ 4 puntos para el ganador, 1 para el perdedor</li>
      <li><strong>5â€“0</strong> â†’ 5 puntos para el ganador, 0 para el perdedor</li>
    </ul>

    <h3>ğŸ§® CONTEO DE SETS</h3>
    <p>
      Se registrarÃ¡n <strong>sets ganados</strong> y <strong>sets perdidos</strong> de todos los partidos del enfrentamiento.<br>
      Se utilizarÃ¡ la diferencia de sets (<strong>SG âˆ’ SP</strong>).
    </p>

    <h3>ğŸ“ˆ CLASIFICACIÃ“N DE LA LIGA</h3>
    <p><strong>Criterios de desempate:</strong></p>
    <ol>
      <li>Mayor nÃºmero de puntos (PTS)</li>
      <li>Mejor diferencia de sets (SG âˆ’ SP)</li>
      <li>Mejor diferencia de juegos (JG âˆ’ JP)</li>
    </ol>

  </div>
  <button id="toggle-reglas" class="toggle-btn">Ver mÃ¡s</button>
</section>

<section id="partidos">
  <h1>ğŸ“… Partidos</h1>
  <div id="btn-instrucciones-container"></div>
  <div id="partidos-list"></div>
</section>

<section id="clasificacion">
  <h1>ğŸ“Š Tabla de ClasificaciÃ³n</h1>
  <div id="tabla-ligaA"><h2>Liga A</h2></div>
  <div id="tabla-ligaB"><h2>Liga B</h2></div>
</section>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="cerrarModal()">&times;</span>

    <div id="form-equipos"></div>

    <form id="form-resultados">
      <div id="sets"></div>
      <button type="submit">Guardar resultado</button>
    </form>
  </div>
</div>

<!-- Modal Instrucciones -->
<div id="modal-instrucciones" class="modal">
  <div class="modal-content">
    <span class="close" onclick="cerrarModalInstrucciones()">&times;</span>

    <h2>Instrucciones para rellenar los resultados</h2>

    <p>Los capitanes deben rellenar los resultados de los <strong>5 partidos</strong> al finalizar cada enfrentamiento.</p>

    <p>En cada partido deben introducir los juegos de cada set tal y como han terminado.</p>

    <ul>
      <li>Si un set no se ha jugado, debe marcarse como <strong>No jugado</strong>.</li>
      <li>Si un partido termina antes de completar los 3 sets, los sets restantes deben marcarse como <strong>No jugado</strong>.</li>
    </ul>

    <h3>ğŸŸ§ Regla del punto de oro al finalizar el tiempo</h3>

    <p><strong>Se debe jugar un punto de oro si al finalizar el tiempo ocurre cualquiera de estas situaciones:</strong></p>

    <ol>
      <li>Cada equipo ha ganado <strong>1 set</strong> y el nÃºmero total de juegos es el mismo.</li>
      <li>Un equipo ha ganado <strong>1 set</strong>, el segundo set estÃ¡ en juego y el nÃºmero total de juegos es el mismo.</li>
    </ol>

    <p>El equipo que gane ese punto de oro debe recibir <strong>1 juego adicional</strong> en el tercer set (o en el set en curso) para que el sistema pueda determinar correctamente el ganador.</p>

    <h3>Ejemplo</h3>
    <p>
      Si un partido termina <strong>6/2</strong>, <strong>2/6</strong> y en el tercer set iban <strong>2/2</strong> cuando se acaba el tiempo, se juega un punto de oro.<br>
      Si lo gana el equipo 2, entonces el resultado que debe introducirse es <strong>2/3</strong> en el tercer set.
    </p>

  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD0ZTk_DkcNiTfwLqON5CVERTvA-oEtcSE",
  authDomain: "torneo-padel-torremolinos.firebaseapp.com",
  projectId: "torneo-padel-torremolinos",
  storageBucket: "torneo-padel-torremolinos.firebasestorage.app",
  messagingSenderId: "1026936066366",
  appId: "1:1026936066366:web:0155cdd880890260b8dc6f",
  measurementId: "G-3SGRD960R9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<!-- Acceso seguro capitanes -->
<script>
let modoCapitan = false;

// FunciÃ³n para generar SHA-256
async function sha256(text) {
  const encoder = new TextEncoder();
  const data = encoder.encode(text);
  const hash = await crypto.subtle.digest("SHA-256", data);
  return Array.from(new Uint8Array(hash))
    .map(b => b.toString(16).padStart(2, "0"))
    .join("");
}

document.addEventListener("DOMContentLoaded", () => {

  /* --- ACCESO CAPITANES --- */
  document.getElementById("btn-capitan").onclick = async () => {
    const entrada = prompt("Introduce el PIN de capitÃ¡n:");
    if (!entrada) return;

    const hashEntrada = await sha256(entrada);
    const doc = await db.collection("config").doc("capitan").get();
    const hashReal = doc.data().pinHash;

    if (hashEntrada === hashReal) {
      firebase.auth().signInAnonymously().then(() => {
        modoCapitan = true;
        alert("Modo capitÃ¡n activado");
        document.getElementById("btn-borrar-todo").style.display = "inline-block";
        renderEnfrentamientos();
        renderBotonInstrucciones();
      });
    } else {
      alert("PIN incorrecto");
    }
  };

  document.getElementById("btn-borrar-todo").onclick = async () => {
  if (!modoCapitan) return;

  const seguro = confirm("âš ï¸ Â¿Seguro que quieres BORRAR TODOS los resultados?\nEsta acciÃ³n no se puede deshacer.");
  if (!seguro) return;

  try {
    const snap = await db.collection("resultados").get();
    const batch = db.batch();

    snap.forEach(doc => batch.delete(doc.ref));

    await batch.commit();

    alert("Todos los resultados han sido borrados.");

    // Resetear estado local
    resultados = {};
    recalcularTablas();
    renderEnfrentamientos();

  } catch (err) {
    console.error("Error borrando resultados:", err);
    alert("Error borrando los resultados.");
  }
};

    /* --- VER MÃS / VER MENOS --- */
  const reglas = document.getElementById("reglas-content");
  const btn = document.getElementById("toggle-reglas");

  // altura inicial recortada
  const ALTURA_INICIAL = 260; // ajusta si quieres mÃ¡s/menos texto visible
  reglas.style.maxHeight = ALTURA_INICIAL + "px";
  reglas.style.overflow = "hidden";

  btn.addEventListener("click", () => {
    const expandido = reglas.classList.toggle("expandido");

    if (expandido) {
      // expandimos
      reglas.style.maxHeight = "5000px";
      btn.textContent = "Ver menos";
    } else {
      // volvemos a recortar
      reglas.style.maxHeight = ALTURA_INICIAL + "px";
      btn.textContent = "Ver mÃ¡s";
      reglas.scrollIntoView({ behavior: "smooth" });
    }
  });
});
</script>
<script src="js/app.js"></script>
</body>
</html>
